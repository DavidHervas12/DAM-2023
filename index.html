<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inicio</title>
    <link rel="stylesheet" href="style_index.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="menu">
      <input type="search" id="search" />
      <button type="submit" id="button-search">
        <span class="material-symbols-outlined">search</span>
      </button>
      <button type="submit" id="button-record">
        <span class="material-symbols-outlined">lists</span>
      </button>
    </div>
    <div class="container">
      <!-- Iba a poner paginación, pero como la api está limitada a una cuota diaria, se acababa muy rápido, así que he decidido no ponerlo. -->
      <!-- <span class="material-symbols-outlined size-100" id="prevPagButton">navigate_before</span> -->
      <div id="videos"></div>
      <!-- <span class="material-symbols-outlined size-100" id="nextPagButton">navigate_next</span> -->
    </div>
  </body>
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script>

    // Realiza una búsqueda de vídeos según el término que se quiera buscar, se obtienen 12 vídeos
    const handleOnClickSearch = () => {
      const input = document.getElementById("search");
      // Realizo una petición get a la api de youtube (necesario registrarse y obtener una api key).
      axios
        .get(
          `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&q=${input.value}&maxResults=12&key=introducirtuapykey`
        )
        .then((response) => {
          generateVideos(response.data);
        })
        .catch((error) => {
          console.error(error);
        });
    };

    // Genera los vídeos y los muestra en el html según la respuesta obtenida por la petición get a la api.
    const generateVideos = (data) => {
      const videos = document.getElementById("videos");
      videos.innerHTML = "";
      console.log(data);
      data.items.map((elem, index) => {
        const video = document.createElement("div");
        video.classList.add("video");

        video.innerHTML = `
      <div>
        <a id='video-${index}' href="https://www.youtube.com/watch?v=${elem.id.videoId}" target="_blank">
          <img src="${elem.snippet.thumbnails.medium.url}" alt="Video Thumbnail">
          </a>
          <p>${elem.snippet.title}</p>
          <p>${elem.snippet.channelTitle}</p>
      </div>
    `;

        videos.appendChild(video);
        const link = document.getElementById(`video-${index}`);
        link.addEventListener("click", () => openVideo(elem));
      });
    };

    // Guarda los datos del video que se ha visualizado a modo de historial, realizando una peticón post al servidor php.
    const openVideo = (data) => {
      $.ajax({
        type: "POST",
        url: "server.php",
        data: { data: JSON.stringify(data) },
        success: function (response) {
          console.log(response);
        },
        error: function () {
          console.log("Error");
        },
      });
    };

    // Te envía a la ventana donde se muestra el historial de los vídeos visualizados.
    const handleOnClickRecord = () => {
      window.location.href = "record.html";
    };

    // Aquí agrego los eventos a los botones.
    const botonSubmit = document.getElementById("button-search");
    botonSubmit.addEventListener("click", handleOnClickSearch);
    const botonRecord = document.getElementById("button-record");
    botonRecord.addEventListener("click", handleOnClickRecord);
  </script>
</html>
